<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Tasks | Keenthemes</title>
    <meta name="description" content="Tasks management" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link rel="canonical" href="https://keenthemes.com/metronic" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" />
    <link href="assets/plugins/global/plugins.bundle.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/custom/prismjs/prismjs.bundle.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/style.bundle.css" rel="stylesheet" type="text/css" />
    <link rel="shortcut icon" href="assets/media/logos/favicon.ico" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        .full-width {
            width: 100%;
        }

        .h-full {
            /* max-height: 72vh !important; */
            height: 100% !important;
            max-width: 100vw !important;
        }

        .chat-window {
            flex: 1;
            overflow-y: auto;
            /* Enable vertical scroll */
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background-color: white;
            height: 100%;
            max-height: calc(100vh - 260px);
            /* Ensure the chat window height adjusts on various devices */
        }

        .chat-bubble {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 15px;
            margin-bottom: 10px;
            max-width: 90%;
            position: relative;
            align-items: flex-start
        }

        .bot-message {
            background-color: transparent;
            text-align: left;
            flex-direction: row;
            float: left;
            clear: both;
            margin-top: 2%;
        }

        .user-message {
            background-color: transparent;
            text-align: left;
            flex-direction: row-reverse;
            justify-content: flex-end;
            float: right;
            clear: both;
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            margin: 0 10px;
            border-radius: 50%;
            align-self: flex-start
        }

        .chat-text {
            max-width: calc(100%);
            word-wrap: break-word;
            padding: 10px !important;
        }

        .user-message .chat-text {
            background-color: #ececec;
            border-radius: 1.5rem;
        }

        .card-footer {
            width: 100%;
            background-color: #fff;
            padding: 10px;
        }

        .input-group {
            width: 100%;
        }

        .typing-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background-color: #007bff;
            border-radius: 50%;
            margin-right: 5px;
            animation: bounce 1.2s infinite ease-in-out both;
        }

        .typing-indicator:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        @media (max-width: 576px) {
            .chat-bubble {
                max-width: 85%;
                font-size: 14px;
            }

            .chat-avatar {
                width: 30px;
                height: 30px;
            }

            .chat-window {
                width: 100%;
                min-height: calc(100vh - 200px);
            }
        }

        @media (min-width: 577px) and (max-width: 768px) {
            .chat-bubble {
                max-width: 80%;
            }

            .chat-window {
                width: 100%;
                min-height: calc(100vh - 180px);
            }
        }

        @media (min-width: 768.1px) {
            .chat-bubble {
                max-width: 90%;
            }

            .chat-window {
                width: 100%;
                min-height: calc(100vh - 240px);
            }
        }
    </style>
</head>

<body id="kt_body"
    class="header-mobile-fixed subheader-enabled aside-enabled aside-fixed aside-secondary-enabled page-loading">
    <div id="kt_header_mobile" class="header-mobile">
        <a href="index.html">
            <img alt="Logo" src="assets/media/logos/logo-letter-2.png" class="logo-default max-h-30px" />
        </a>
        <div class="d-flex align-items-center">
            <button class="btn p-0 burger-icon burger-icon-left" id="kt_aside_mobile_toggle">
                <span></span>
            </button>
        </div>
    </div>
    <div class="d-flex flex-column flex-root">
        <div class="d-flex flex-row flex-column-fluid page">
            <div class="aside aside-left" id="kt_aside">
                <div class="">
                    <div class="aside-workspace scroll scroll-push my-2">
                        <div class="tab-content m-5">
                            <div class="tab-pane p-3 px-lg-7 py-lg-5 fade show active" id="kt_aside_tab_1">
                                <div class="brand flex-column-auto mb-6" id="kt_brand" kt-hidden-height="65" style="">
                                    <a href="index.html" class="brand-logo">
                                        <img alt="Logo" src="assets/media/logos/logo-dark.png">
                                    </a>
                                </div>
                                <form action="">
                                    <div class="btn btn-primary full-width" role="presentation" tabindex="0"
                                        id="file-upload" data-toggle="tooltip" title data-placement="left"
                                        data-original-title="Start New Chat">
                                        <input id="fileInput" accept="" multiple="" type="file" style="display: none;">
                                        <span class="d-none d-md-inline">+ Start New Chat with PDF</span>
                                        <span class="svg-icon svg-icon-lg">
                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px"
                                                viewBox="0 0 24 24" version="1.1">
                                                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                    <polygon points="0 0 24 0 24 24 0 24" />
                                                    <path
                                                        d="M5.85714286,2 L13.7364114,2 C14.0910962,2 14.4343066,2.12568431 14.7051108,2.35473959 L19.4686994,6.3839416 C19.8056532,6.66894833 20,7.08787823 20,7.52920201 L20,20.0833333 C20,21.8738751 19.9795521,22 18.1428571,22 L5.85714286,22 C4.02044787,22 4,21.8738751 4,20.0833333 L4,3.91666667 C4,2.12612489 4.02044787,2 5.85714286,2 Z"
                                                        fill="#000000" fill-rule="nonzero" opacity="0.3" />
                                                    <rect fill="#000000" x="6" y="11" width="9" height="2" rx="1" />
                                                    <rect fill="#000000" x="6" y="15" width="5" height="2" rx="1" />
                                                </g>
                                            </svg>
                                        </span>
                                    </div>
                                </form>
                                <h3 class="p-2 p-lg-3 my-1 my-lg-3">History</h3>
                                <h6 class="p-2 p-lg-3 my-1 my-lg-3 font-weight-semi-bold">Today</h6>
                                <div class="list list-hover">
                                    <div class="list-item hoverable p-2 p-lg-3 mb-2">
                                        <div class="d-flex align-items-center">
                                            <div class="d-flex flex-column flex-grow-1 mr-2">
                                                <a href="#" class="text-muted text-hover-primary">
                                                    <span class="text-dark-75 font-size-h6 mb-0">Getting Start with
                                                        OneDrive.pdf</span>
                                                    <p class="font-weight-bold mb-0">8:30 AM</p>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <h6 class="p-2 p-lg-3 my-1 my-lg-3 font-weight-semi-bold">Yesterday</h6>
                                <div class="list list-hover">
                                    <div class="list-item hoverable p-2 p-lg-3 mb-2">
                                        <div class="d-flex align-items-center">
                                            <div class="d-flex flex-column flex-grow-1 mr-2">
                                                <a href="#" class="text-muted text-hover-primary">
                                                    <span
                                                        class="text-dark-75 font-size-h6 mb-0">National_AI_Policy_2024_Draft_Mode.pdf</span>
                                                    <p class="font-weight-bold mb-0">5:30 PM, Yesterday</p>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <h6 class="p-2 p-lg-3 my-1 my-lg-3 font-weight-semi-bold">Earlier</h6>
                                <div class="list list-hover">
                                    <div class="list-item hoverable p-2 p-lg-3 mb-2">
                                        <div class="d-flex align-items-center">
                                            <div class="d-flex flex-column flex-grow-1 mr-2">
                                                <a href="#" class="text-muted text-hover-primary">
                                                    <span
                                                        class="text-dark-75 font-size-h6 mb-0">National_AI_Policy_2024_Draft_Mode.pdf</span>
                                                    <p class="font-weight-bold mb-0">5:30 PM, Yesterday</p>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="list list-hover">
                                    <div class="list-item hoverable p-2 p-lg-3 mb-2">
                                        <div class="d-flex align-items-center">
                                            <div class="d-flex flex-column flex-grow-1 mr-2">
                                                <a href="#" class="text-muted text-hover-primary">
                                                    <span
                                                        class="text-dark-75 font-size-h6 mb-0">National_AI_Policy_2024_Draft_Mode.pdf</span>
                                                    <p class="font-weight-bold mb-0">5:30 PM, Yesterday</p>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <button class="btn btn-sm btn-bg-light btn-hover-primary">Load More</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="d-flex flex-column flex-row-fluid wrapper" id="kt_wrapper">
                <div class="content d-flex flex-column flex-column-fluid" id="kt_content">
                    <div class="subheader py-3 py-lg-8 subheader-transparent" id="kt_subheader">
                        <div
                            class="container d-flex align-items-center justify-content-between flex-wrap flex-sm-nowrap">
                            <div class="d-flex align-items-center mr-1">
                                <div class="dropdown dropdown-inline d-inline-block d-lg-none ml-2 mr-4">
                                    <a href="#" class="px-2 px-lg-5 mr-2" data-toggle="dropdown" aria-haspopup="true"
                                        aria-expanded="false">
                                        <i class="fa-solid fa-ellipsis-vertical"></i>
                                    </a>
                                    <div class="dropdown-menu p-0 m-0 dropdown-menu-md dropdown-menu-right">
                                        <ul class="navi navi-hover">
                                            <li class="navi-header font-weight-bold py-4">
                                                <span class="font-size-lg">Chat Experience</span>
                                            </li>
                                            <li class="navi-header font-weight-bold py-4">
                                                <span class="font-size-lg">Custom Instruction</span>
                                            </li>
                                            <li class="navi-header font-weight-bold py-4">
                                                <span class="font-size-lg">Reset Chat</span>
                                            </li>
                                            <li class="navi-header font-weight-bold py-4">
                                                <span class="font-size-lg">Share Chat</span>
                                            </li>
                                            <li class="navi-header font-weight-bold py-4">
                                                <span class="font-size-lg">Export Chat</span>
                                            </li>
                                            <li class="navi-header font-weight-bold py-4">
                                                <span class="font-size-lg text-danger">Delete Chat</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="d-flex align-items-baseline flex-wrap mr-5">
                                    <h2 class="d-flex align-items-center text-dark font-weight-bold my-1 mr-3"
                                        id="chat-title">
                                    </h2>
                                </div>
                            </div>
                            <div class="d-flex align-items-center flex-wrap">
                                <div class="dropdown dropdown-inline" data-toggle="tooltip" title="" data-placement="left" data-original-title="Quick actions">
                                    <a href="#" class="px-2 px-lg-5 mr-2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <img class="symbol symbol-35px symbol-md-40px" style="border-radius: 50%;"
                                            src="{{ asset('assets') }}/media/users/100_12.jpg" alt="user" width="50"
                                            height="50" />
                                    </a>
                                    <div class="dropdown-menu p-0 m-0 dropdown-menu-md dropdown-menu-right">
                                        <ul class="navi navi-hover">
                                            <li class="navi-header font-weight-bold py-4">
                                                <div
                                                    class="user-identity d-sm-flex flex-column justify-content-center me-2 me-md-4">
                                                    <span class="fs-8 fw-bold lh-1"><strong>Asif M Sazid
                                                            Tappware</strong></span>
                                                    <span class="opacity-75 fs-8 lh-1 mb-1">GUEST</span>
                                                </div>
                                            </li>
                                            <li class="navi-header font-weight-bold py-4">
                                                <span class="font-size-lg">Settings</span>
                                            </li>
                                            <li class="navi-header font-weight-bold py-4">
                                                <span class="font-size-lg">Upgrade</span>
                                            </li>
                                            <li class="navi-header font-weight-bold py-4">
                                                <span class="font-size-lg">Logout</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <!-- <a href="{{ route('register') }}" class="btn btn-flex btn-sm fw-bold btn-dark py-3">Sign Up</a> -->
                            </div>
                        </div>
                    </div>
                    <div class="d-flex flex-column-fluid">
                        <div class="container h-full">
                            <div class="card card-flush card-chat h-xl-100">
                                <div class="card-body chat-window" id="chat-window">
                                </div>
                                <div class="card-footer">
                                    <form id="chat-form">
                                        <div class="input-group">
                                            <input type="text" id="user-input" class="form-control"
                                                placeholder="Type a message..." required>
                                            <button id="submitButton" class="btn btn-primary" type="submit" disabled>
                                                <i class="fas fa-paper-plane"></i>
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="footer py-4 d-flex flex-lg-column" id="kt_footer">
                    <div class="container d-flex flex-column flex-md-row align-items-center justify-content-between">
                        <div class="text-dark order-2 order-md-1">
                            <span class="text-muted font-weight-bold mr-2">2021Â©</span>
                            <a href="http://keenthemes.com/metronic" target="_blank"
                                class="text-dark-75 text-hover-primary">Keenthemes</a>
                        </div>
                        <div class="nav nav-dark order-1 order-md-2">
                            <a href="http://keenthemes.com/metronic" target="_blank" class="nav-link pr-3 pl-0">Terms &
                                Condition</a>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <div id="kt_scrolltop" class="scrolltop">
        <span class="svg-icon">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px"
                height="24px" viewBox="0 0 24 24" version="1.1">
                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                    <polygon points="0 0 24 0 24 24 0 24" />
                    <rect fill="#000000" opacity="0.3" x="11" y="10" width="2" height="10" rx="1" />
                    <path
                        d="M6.70710678,12.7071068 C6.31658249,13.0976311 5.68341751,13.0976311 5.29289322,12.7071068 C4.90236893,12.3165825 4.90236893,11.6834175 5.29289322,11.2928932 L11.2928932,5.29289322 C11.6714722,4.91431428 12.2810586,4.90106866 12.6757246,5.26284586 L18.6757246,10.7628459 C19.0828436,11.1360383 19.1103465,11.7686056 18.7371541,12.1757246 C18.3639617,12.5828436 17.7313944,12.6103465 17.3242754,12.2371541 L12.0300757,7.38413782 L6.70710678,12.7071068 Z"
                        fill="#000000" fill-rule="nonzero" />
                </g>
            </svg>
        </span>
    </div>
    <ul class="sticky-toolbar nav flex-column pl-2 pr-2 pt-3 pb-3 mt-4">
        <li class="nav-item mb-2" id="kt_demo_panel_toggle" data-toggle="tooltip" title="Tools" data-placement="right">
            <a class="btn btn-sm btn-icon btn-bg-light btn-icon-success btn-hover-success" href="#">
                <i class="fa-solid fa-chevron-left"></i>
            </a>
        </li>
    </ul>
    <div id="kt_demo_panel" class="offcanvas offcanvas-right p-10">
        <div class="offcanvas-header d-flex align-items-center justify-content-between pb-7">
            <h4 class="font-weight-bold m-0">Attached File</h4>
            <a href="#" class="btn btn-xs btn-icon btn-light btn-hover-primary" id="kt_demo_panel_close">
                <i class="ki ki-close icon-xs text-muted"></i>
            </a>
        </div>
        <div class="offcanvas-content">
            <div class="offcanvas-wrapper mb-5 scroll-pull">
            </div>
            <div class="offcanvas-footer">
                <a href="https://1.envato.market/EA4JP" target="_blank"
                    class="btn btn-block btn-primary btn-shadow font-weight-bolder text-uppercase">Custom
                    Instruction</a>
                <a href="https://1.envato.market/EA4JP" target="_blank"
                    class="btn btn-block btn-danger btn-shadow font-weight-bolder text-uppercase">More Settings</a>
            </div>
        </div>
    </div>
    <script>var HOST_URL = "https://preview.keenthemes.com/metronic/theme/html/tools/preview";</script>
    <script>var KTAppSettings = { "breakpoints": { "sm": 576, "md": 768, "lg": 992, "xl": 1200, "xxl": 1200 }, "colors": { "theme": { "base": { "white": "#ffffff", "primary": "#1BC5BD", "secondary": "#E5EAEE", "success": "#1BC5BD", "info": "#6993FF", "warning": "#FFA800", "danger": "#F64E60", "light": "#F3F6F9", "dark": "#212121" }, "light": { "white": "#ffffff", "primary": "#1BC5BD", "secondary": "#ECF0F3", "success": "#C9F7F5", "info": "#E1E9FF", "warning": "#FFF4DE", "danger": "#FFE2E5", "light": "#F3F6F9", "dark": "#D6D6E0" }, "inverse": { "white": "#ffffff", "primary": "#ffffff", "secondary": "#212121", "success": "#ffffff", "info": "#ffffff", "warning": "#ffffff", "danger": "#ffffff", "light": "#464E5F", "dark": "#ffffff" } }, "gray": { "gray-100": "#F3F6F9", "gray-200": "#ECF0F3", "gray-300": "#E5EAEE", "gray-400": "#D6D6E0", "gray-500": "#B5B5C3", "gray-600": "#80808F", "gray-700": "#464E5F", "gray-800": "#1B283F", "gray-900": "#212121" } }, "font-family": "Poppins" };</script>
    <script src="assets/plugins/global/plugins.bundle.js"></script>
    <script src="assets/plugins/custom/prismjs/prismjs.bundle.js"></script>
    <script src="assets/js/scripts.bundle.js"></script>
    <script src="assets/js/pages/custom/todo/todo.js"></script>


    <script>
        // Function to handle file uploads and drag-and-drop
        const fileDropArea = document.getElementById('file-upload');
        const fileInput = document.getElementById('fileInput');
        const responseBody = document.getElementById('responseBody');
        const chatTitle = document.getElementById('chat-title');
        const submitButton = document.getElementById('submitButton');
        const chatWindow = document.getElementById('chat-window');
        const userInput = document.getElementById('user-input');
        const chatForm = document.getElementById('chat-form');

        let extractDocText = '';

        // Click event to open file dialog
        fileDropArea.addEventListener('click', () => {
            fileInput.click();
        });

        // Drag and Drop functionality
        fileDropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileDropArea.classList.add('drag-over');
        });

        fileDropArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            fileDropArea.classList.remove('drag-over');
        });

        fileDropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileDropArea.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFiles(files);
            }
        });

        // File input change event
        fileInput.addEventListener('change', (event) => {
            const files = event.target.files;
            handleFiles(files);
        });

        function titleChange(fileName) {
            const fullTitle = `${fileName}`;
            let index = 0;

            const typingInterval = setInterval(() => {
                if (index < fullTitle.length) {
                    chatTitle.textContent += fullTitle.charAt(index);
                    index++;
                } else {
                    clearInterval(typingInterval); // Stop the typing effect once complete
                }
            }, 50);
        }

        // Function to handle files
        async function handleFiles(files) {
            if (files.length > 0) {
                try {
                    const file = files[0];
                    const fileName = file.name;

                    // Show the file name as a message in the user's chat bubble
                    addMessage(`Uploaded file: ${file.name}`, 'user-message', 'user');

                    // Proceed to upload and summarize the file
                    await summarizedTextResponse(file);

                    submitButton.disabled = false;

                    titleChange(fileName);
                } catch (error) {
                    console.error('Error:', error);
                    const errorMessage = "Sorry, something went wrong while processing the file. Please try again.";
                    simulateTypingEffect(errorMessage);
                }
            } else {
                alert('No files selected');
            }
        }

        // Function to get and display summarized text response
        async function summarizedTextResponse(file) {
            try {
                const formData = new FormData();
                formData.append('pdf', file);

                // Show typing indicator while the API processes the file
                showTypingIndicator();

                const response = await fetch(
                    'http://62.171.163.137:8055/api/pdf_to_summary/', { // Replace with your API URL
                    method: 'POST',
                    body: formData
                });

                removeTypingIndicator(); // Remove typing indicator once response is received

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const result = await response.json();
                extractDocText = result.extracted_text;

                console.log('PDF Summary Result:', result); // Debugging log

                // Check if there is a valid summary in the result, otherwise show an error message
                if (result.summary) {
                    simulateTypingEffect(result);
                } else {
                    simulateTypingEffect("Unable to summarize the document. Please try another file.");
                }

            } catch (error) {
                console.error('Error uploading file:', error);
                removeTypingIndicator(); // Ensure the typing indicator is removed even on error
                const errorMessage = "Sorry, something went wrong while processing the file. Please try again.";
                simulateTypingEffect(errorMessage);
            }
        }

        // Function to handle form submit event
        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault(); // Prevent the form from refreshing the page

            userMessage = userInput.value.trim();
            if (userMessage) {
                addMessage(userMessage, 'user-message', 'user');
                userInput.value = ''; // Clear input field

                try {
                    await handleChatRequest();
                } catch (error) {
                    console.error('Error handling chat request:', error);
                    removeTypingIndicator(); // Ensure typing indicator is removed even on error
                    const errorMessage =
                        "Sorry, something went wrong while sending the message. Please try again.";
                    simulateTypingEffect(errorMessage);
                }
            }
        });

        // Function to handle chat request
        async function handleChatRequest() {
            try {
                const response = await fetch('/get-extracted-text');

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const result = await response.json();
                extractDocText = result.extracted_text;

                // Show typing indicator while the bot is "thinking"
                showTypingIndicator();

                // Send the query to the API
                const apiResponse = await fetch(
                    'http://62.171.163.137:8055/api/text_with_query/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: extractDocText,
                        query: userMessage
                    })
                });

                removeTypingIndicator();

                if (!apiResponse.ok) {
                    throw new Error('Network response was not ok');
                }

                const apiResult = await apiResponse.json();
                console.log('Chat API Result:', apiResult); // Debugging log

                // Check if the result contains a valid answer
                if (apiResult.answer) {
                    simulateTypingEffect(apiResult);
                } else {
                    simulateTypingEffect("Sorry, I couldn't find an answer to your query. Please try again.");
                }

            } catch (error) {
                console.error('Error:', error);
                removeTypingIndicator(); // Remove typing indicator even on error
                const errorMessage = "Sorry, something went wrong while sending the message. Please try again.";
                simulateTypingEffect(errorMessage);
            }
        }

        // Add messages to chat window
        function addMessage(message, className, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chat-bubble', className);

            const avatar = document.createElement('img');
            avatar.classList.add('chat-avatar');
            avatar.src = sender === 'user' ? 'assets/media/users/100_12.jpg' : 'assets/media/chatbot/ai-chatbot-4.png';

            const textDiv = document.createElement('div');
            textDiv.classList.add('chat-text');
            textDiv.innerText = message;

            messageDiv.appendChild(avatar);
            messageDiv.appendChild(textDiv);
            chatWindow.appendChild(messageDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        // Show typing indicator for bot response
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.classList.add('chat-bubble', 'bot-message');
            typingDiv.innerHTML = `
			<img src="assets/media/chatbot/ai-chatbot-4.png" class="chat-avatar">
			<span class="typing-indicator"></span>
			<span class="typing-indicator"></span>
			<span class="typing-indicator"></span>
		`;
            typingDiv.id = 'typing-indicator'; // Add ID for easy removal
            chatWindow.appendChild(typingDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        // Remove typing indicator
        function removeTypingIndicator() {
            const typingDiv = document.getElementById('typing-indicator');
            if (typingDiv) {
                typingDiv.remove();
            }
        }

        // Escape HTML special characters to avoid rendering HTML tags
        function escapeHtml(html) {
            const text = document.createTextNode(html);
            const div = document.createElement('div');
            div.appendChild(text);
            return div.innerHTML;
        }

        // Simulate typing effect for bot response
        function simulateTypingEffect(responseText) {
            const suggestedQueries = responseText.suggested_queries || []; // Default to an empty array if not present

            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chat-bubble', 'bot-message');

            const avatar = document.createElement('img');
            avatar.classList.add('chat-avatar');
            avatar.src = 'assets/media/chatbot/ai-chatbot-4.png';

            // Create a container for the text and buttons
            const contentDiv = document.createElement('div');
            contentDiv.classList.add('content-container');

            const textDiv = document.createElement('div');
            textDiv.classList.add('chat-text');

            contentDiv.appendChild(textDiv);

            // Append the avatar and content container to the messageDiv
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);

            chatWindow.appendChild(messageDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;

            // Process the main response text
            const responseTextContent = responseText.summary || responseText.answer ||
                "Sorry, something went wrong. Please try again.";
            let formattedText = textFormation(responseTextContent);

            let index = 0;
            let tempDiv = document.createElement("div");
            tempDiv.innerHTML = formattedText;
            let nodes = Array.from(tempDiv.childNodes);

            function typeNextNode() {
                if (index < nodes.length) {
                    // Append the current node (either text or HTML element) to the target element
                    textDiv.appendChild(nodes[index].cloneNode(true));
                    chatWindow.scrollTop = chatWindow.scrollHeight;
                    index++;
                    setTimeout(typeNextNode, 50); // Adjust the delay (50ms)
                } else {
                    // Once typing is complete, show the suggested queries one by one
                    showSuggestedQueries(suggestedQueries, textDiv);
                }
            }

            typeNextNode(); // Start typing
        }

        function showSuggestedQueries(queries, container) {
            let queryIndex = 0;

            function displayNextQuery() {
                if (queryIndex < queries.length - 2) {
                    const textBtn = document.createElement('button');

                    const icon = document.createElement('i');
                    icon.classList.add('fa-regular', 'fa-circle-right', 'ms-2');
                    textBtn.appendChild(icon);

                    textBtn.appendChild(document.createTextNode(queries[queryIndex]));
                    textBtn.classList.add('btn', 'btn-text-success', 'btn-hover-light-success', 'font-weight-bold', 'mr-2',
                        'text-left'); // Apply Bootstrap 5 classes and margin

                    textBtn.addEventListener('click', () => {
                        handleQuestionClick(textBtn.innerText);
                    });

                    // Append the button to the container
                    container.appendChild(textBtn);
                    chatWindow.scrollTop = chatWindow.scrollHeight;

                    queryIndex++;
                    // Add delay before showing the next button
                    setTimeout(displayNextQuery, 300); // Adjust the delay (300ms) as needed
                }
            }

            if (queries) {
                displayNextQuery(); // Start showing buttons
            }
        }



        // Text formatting function
        function textFormation(responseText) {
            let formattedSummary = responseText
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold text
                .replace(/## (.*?)\n/g, '<h4>$1</h4>') // Headings
                .replace(/^- (.*)/gm, '<li>$1</li>') // Bullet points
                .replace(/\n/g, '<br>'); // Newline to <br>

            return formattedSummary;
        }

        async function handleQuestionClick(question) {
            // console.log('Button clicked:', question);
            userMessage = question
            addMessage(userMessage, 'user-message', 'user');
            userInput.value = ''; // Clear input field

            try {
                await handleChatRequest();
            } catch (error) {
                console.error('Error handling chat request:', error);
                removeTypingIndicator(); // Ensure typing indicator is removed even on error
                const errorMessage =
                    "Sorry, something went wrong while sending the message. Please try again.";
                simulateTypingEffect(errorMessage);
            }
        }
    </script>

</body>

</html>